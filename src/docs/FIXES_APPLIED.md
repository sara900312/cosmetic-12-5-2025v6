# ๐ง ุงูุฅุตูุงุญุงุช ุงูุดุงููุฉ ุงููุทุจูุฉ ุนูู ูุธุงู ุงูุทูุจุงุช

## ๐ **ููุฎุต ุงููุดุงูู ุงููุญูููุฉ**

### 1๏ธโฃ **ูุดุงูู ุงูุฃุนูุฏุฉ ุงูููููุฏุฉ (order_items/main_store)**
- **ุงููุดููุฉ:** ูุญุงููุฉ ุงููุตูู ูุฃุนูุฏุฉ ุบูุฑ ููุฌูุฏุฉ ูู schema
- **ุงูุญู:** ูุตู ุงูุจูุงูุงุช ุจูู ุฌุฏูู `orders` ู `order_items`
- **ุงูุชุทุจูู:** 
  - ุฅุฒุงูุฉ `order_items` ูู ุจูุงูุงุช ุฌุฏูู `orders`
  - ุฅูุดุงุก ููุทู ูููุตู ูุญูุธ ุงูุนูุงุตุฑ ูู `order_items`
  - ุงุณุชุฎุฏุงู `main_store_name` (ูุต) ุจุฏูุงู ูู `main_store` (UUID)

### 2๏ธโฃ **ูุดุงูู UUID ูุงููุนุฑูุงุช**
- **ุงููุดููุฉ:** ุฅุฑุณุงู ูุตูุต ูุซู `"fast-store-1755538796600-..."` ูู ุญููู UUID
- **ุงูุญู:** ุฅูุดุงุก ููุชุจุฉ `uuidUtils.js` ุดุงููุฉ
- **ุงูุชุทุจูู:**
  - ุฏุงูุฉ `generateIdempotencyKey()` ุชููุฏ UUID ุตุญูุญ ุฏุงุฆูุงู
  - ุฏุงูุฉ `sanitizeOrderItems()` ุชูุธู ุงูุจูุงูุงุช ูุจู ุงูุฅุฑุณุงู
  - ุฏุงูุฉ `getStoreName()` ุชุณุชุฎุฑุฌ ุฃุณูุงุก ุงููุชุงุฌุฑ ุจุฃูุงู

### 3๏ธโฃ **ูุดุงูู idempotency_key**
- **ุงููุดููุฉ:** ุงุณุชุฎุฏุงู ููุงุชู๏ฟฝ๏ฟฝ ูุนูุฏุฉ ุบูุฑ UUID ุตุญูุญุฉ
- **ุงูุญู:** ุชูููุฏ UUID ุจุณูุท ูุตุญูุญ ููู ุทูุจ
- **ุงูุชุทุจูู:**
  ```javascript
  const idempotencyKey = generateIdempotencyKey(); // ุฏุงุฆูุงู UUID ุตุญูุญ
  ```

### 4๏ธโฃ **ูุดุงูู ุงุณุชุฌุงุจุฉ ุงูุทูุจุงุช**
- **ุงููุดููุฉ:** ุชูุณููุงุช ูุฎุชููุฉ ููุดุญู ุงูุณุฑูุน/ุงูููุญุฏ
- **ุงูุญู:** ุฅูุดุงุก `orderResponseHandler.js`
- **ุงูุชุทุจูู:**
  - ุฏุงูุฉ `processOrderResponse()` ุชูุญุฏ ุงูุชูุณููุงุช
  - ุฏุงูุฉ `normalizeOrdersResponse()` ุชุญูู ุงูุงุณุชุฌุงุจุงุช ููุตูููุฉ
  - ูุนุงูุฌุฉ ุฃุฎุทุงุก ุฐููุฉ ูุน ุงูุชุฑุงุญุงุช ุญููู

### 5๏ธโฃ **ูุดุงูู ุงููุฎุฒูู**
- **ุงููุดููุฉ:** ุนุฏู ุงูุชุญูู ุงูููุฑู ูู ุงููุฎุฒูู
- **ุงูุญู:** ุฅูุดุงุก `inventoryManager.js`
- **ุงูุชุทุจูู:**
  - ุฏุงูุฉ `checkCartStock()` ููุชุญูู ุงูููุฑู
  - ุฏุงูุฉ `reserveProducts()` ูุญุฌุฒ ุงูููุชุฌุงุช
  - ุฏุงูุฉ `confirmOrderStock()` ูุชุฃููุฏ ุงููุฎุฒูู

### 6๏ธโฃ **ูุดุงูู ุฅุฏุงุฑุฉ ุงููุชุงุฌุฑ**
- **ุงููุดููุฉ:** ุชุนููุฏ ูู ุงุณุชุฎุฑุงุฌ ุฃุณูุงุก ุงููุชุงุฌุฑ
- **ุงูุญู:** ุฏุงูุฉ `getStoreName()` ููุญุฏุฉ
- **ุงูุชุทุจูู:**
  ```javascript
  const storeName = getStoreName(product.main_store_name || product.main_store);
  ```

---

## ๐ **ุงููููุงุช ุงูุฌุฏูุฏุฉ ุงููููุดุฃุฉ**

### `/lib/uuidUtils.js`
- ุฅุฏุงุฑุฉ UUID ุตุญูุญุฉ
- ุชูุธูู ูุชุญูู ูู ุงููุนุฑูุงุช
- ุงุณุชุฎุฑุงุฌ ุฃุณูุงุก ุงููุชุงุฌุฑ

### `/lib/inventoryManager.js`
- ุฅุฏุงุฑุฉ ุงููุฎุฒูู ูุงูุชุญูู ุงูููุฑู
- ุญุฌุฒ ูุฅูุบุงุก ุญุฌุฒ ุงูููุชุฌุงุช
- ุชุฃููุฏ ุงููุฎุฒูู ุนูุฏ ุงูุทูุจ

### `/lib/orderResponseHandler.js`
- ูุนุงูุฌุฉ ุงุณุชุฌุงุจุงุช ุงูุทูุจุงุช
- ุชูุญูุฏ ุชูุณููุงุช ุงูุดุญู ุงูุณุฑูุน/ุงูููุญุฏ
- ูุนุงูุฌุฉ ุฃุฎุทุงุก ุฐููุฉ

### `/lib/ordersFetcher.js`
- ุฌูุจ ุงูุทูุจุงุช ูุน ุงูุนูุงุตุฑ ุงููุฑุชุจุทุฉ
- ููุชุฑุฉ ูุจุญุซ ูุชูุฏู
- ุฅุญุตุงุฆูุงุช ุดุงููุฉ

### `/examples/ordersSystemExample.js`
- ุฃูุซูุฉ ุนูููุฉ ุดุงููุฉ
- ุงุฎุชุจุงุฑุงุช ูููุธุงู ุงูุฌุฏูุฏ
- ุชูุถูุญุงุช ููุงุณุชุฎุฏุงู

---

## ๐ **ุงููููุงุช ุงูููุญุฏูุซุฉ**

### `CheckoutPage.jsx`
- ุงุณุชุฎุฏุงู ุงูููุชุจุงุช ุงูุฌุฏูุฏุฉ
- ุฅุตูุงุญ ููุทู ุฅูุดุงุก ุงูุทูุจุงุช
- ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

### `CartContext.jsx`
- ุฅุถุงูุฉ ุงูุชุญูู ูู ุงููุฎุฒูู
- ุฑุจุท ูุน ูุธุงู inventory

---

## ๐ **ููููุฉ ุงูุงุณุชุฎุฏุงู ุงูุตุญูุญ**

### **1. ๏ฟฝ๏ฟฝูุดุงุก ุทูุจ ุฌุฏูุฏ:**
```javascript
import { generateIdempotencyKey, sanitizeOrderItems } from '@/lib/uuidUtils';

// ุฅูุดุงุก ุงูุทูุจ
const orderData = {
  order_code: generateOrderCode('ORD-'),
  idempotency_key: generateIdempotencyKey(), // UUID ุตุญูุญ
  // ... ุจุงูู ุงูุจูุงูุงุช
};

// ุฅุถุงูุฉ ุงูุนูุงุตุฑ ูููุตูุฉ
const orderItems = sanitizeOrderItems(cartItems, orderId);
```

### **2. ุงูุชุญูู ูู ุงููุฎุฒูู:**
```javascript
import { checkCartStock } from '@/lib/inventoryManager';

const stockResult = await checkCartStock(supabase, cartItems);
if (!stockResult.allAvailable) {
  // ุนุฑุถ ุงูููุชุฌุงุช ุบูุฑ ุงููุชููุฑุฉ
  console.log(stockResult.unavailableItems);
}
```

### **3. ุฌูุจ ุงูุทูุจุงุช ูุน ุงูุนูุงุตุฑ:**
```javascript
import { fetchOrdersWithItems } from '@/lib/ordersFetcher';

const orders = await fetchOrdersWithItems(supabase);
// ูู ุทูุจ ูุญุชูู ุนูู order_items ูุฑุชุจุทุฉ
```

### **4. ูุนุงูุฌุฉ ุงูุงุณุชุฌุงุจุงุช:**
```javascript
import { processOrderResponse, showOrderToast } from '@/lib/orderResponseHandler';

const processedResponse = processOrderResponse(response, shippingType);
showOrderToast(processedResponse, toast, storesList);
```

---

## โ **ุงููุชุงุฆุฌ ุงููุญููุฉ**

1. **๐ง UUID ุตุญูุญุฉ:** ูุง ูุฒูุฏ ูู ุฃุฎุทุงุก `invalid input syntax for type uuid`
2. **๐ฆ ุทูุจุงุช ูููุตูุฉ:** `orders` ู `order_items` ูู ุฌุฏุงูู ูููุตูุฉ ููุง ูู ูุทููุจ
3. **๐ ุดุญู ุตุญูุญ:** ุงูุดุญู ุงูุณุฑูุน ููุดุฆ ุทูุจุงุช ูุชุนุฏุฏุฉุ ุงูููุญุฏ ููุดุฆ ุทูุจ ูุงุญุฏ
4. **๐ ูุฎุฒูู ููุฑู:** ุงูุชุญูู ูู ุงููุฎุฒูู ูุจู ุฅูุดุงุก ุงูุทูุจ
5. **๐ฏ ุงุณุชุฌุงุจุงุช ููุญุฏุฉ:** ูุนุงูุฌุฉ ููุญุฏุฉ ููุดุญู ุงูุณุฑูุน ูุงูููุญุฏ
6. **๐ ุจุญุซ ูุชูุฏู:** ุฌูุจ ุงูุทูุจุงุช ูุน ููุชุฑุฉ ูุฅุญุตุงุฆูุงุช

---

## ๐งช **ุงูุงุฎุชุจุงุฑ**

```javascript
// ุชุดุบูู ุฌููุน ุงูุงุฎุชุจุงุฑุงุช
import { runOrdersSystemTests } from '@/examples/ordersSystemExample';
await runOrdersSystemTests(supabase);

// ุงุฎุชุจุงุฑ ูุธุงู ุงููุฎุฒูู
import { inventoryExamples } from '@/lib/inventoryManager';
await inventoryExamples.checkFullCart(supabase, cartItems);

// ุงุฎุชุจุงุฑ ูุนุงูุฌุฉ ุงูุงุณุชุฌุงุจุงุช
import { responseHandlerExamples } from '@/lib/orderResponseHandler';
const result = responseHandlerExamples.processFastShipping(response);
```

---

## ๐๏ธ **ููุงุญุธุงุช ุชุทููุฑูุฉ**

1. **ุฃููููุฉ ุงูุญููู:** `main_store_name` (ูุต) ุฃููู ูู `main_store` (UUID)
2. **ุชูุธูู ุชููุงุฆู:** ุฌููุน ุงูุจูุงูุงุช ุชููุธู ูุจู ุงูุฅุฑุณุงู
3. **ูุนุงูุฌุฉ ุฃุฎุทุงุก:** ุฑุณุงุฆู ูุงุถุญุฉ ูุน ุงูุชุฑุงุญุงุช ุญููู
4. **ุฃุฏุงุก ูุญุณู:** ุงุณุชุนูุงูุงุช ูุญุณูุฉ ูููุชุฑุฉ ุฐููุฉ
5. **ูุงุจููุฉ ุงูุชูุณุน:** ููุฏ ููุธู ููุงุจู ููุตูุงูุฉ

---

## ๐ **ุงูุฏุนู**

- ุฌููุน ุงูุฏูุงู ููุซูุฉ ูููุง ุฃูุซูุฉ
- ูููุงุช ููุตูุฉ ูู console
- ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ุจุงููุบุฉ ุงูุนุฑุจูุฉ
- ุงุฎุชุจุงุฑุงุช ุดุงููุฉ ุฌุงูุฒุฉ ููุชุดุบูู

**โ ุงููุธุงู ุงูุขู ุฌุงูุฒ ููุฅูุชุงุฌ ููุญููู ุจุงููุงูู!**
