# ๐ฆ ุฏููู ูุธุงู ุชุญุถูุฑ ุจูุงูุงุช ุงูุทูุจุงุช ุงููุญุณู

## ๐ฏ ุงููุฏู
ุชุญุณูู ุทุฑููุฉ ุฅุฑุณุงู ุงูุทูุจุงุช ุฅูู Edge Function `order-notification` ูุน ุฏุนู:
- ุงูุดุญู ุงูุณุฑูุน (ุทูุจ ูููุตู ููู ูุชุฌุฑ)
- ุงูุดุญู ุงูููุญุฏ (ุทูุจ ูุงุญุฏ ูุฌููุน ุงูููุชุฌุงุช)
- ุชูุธูู ุชููุงุฆู ููุจูุงูุงุช ุงููุนุทูุจุฉ ูุงูููุฑุฑุฉ
- order_code ุนุดูุงุฆู (8 ุฃุญุฑู ุจุฏูู ุจุงุฏุฆุฉ)
- ุงูุชุญูู ูู ุงูุญููู ุงููุทููุจุฉ
- JSON ุฌุงูุฒ ููุฅุฑุณุงู ูุจุงุดุฑุฉ

## ๐ง ุงููููุงุช ุงููุถุงูุฉ/ุงููุญุฏุซุฉ

### 1. `src/lib/orderPayloadUtils.js`
ุฏูุงู ูุณุงุนุฏุฉ ูุชุญุถูุฑ ูุฅุฑุณุงู ุจูุงูุงุช ุงูุทูุจุงุช:

#### ุงูุฏูุงู ุงูุฑุฆูุณูุฉ:
- `prepareOrderPayload()` - ุชุญุถูุฑ ุงูุจูุงูุงุช ูุน ุงูุชูุธูู ูุงูุชุญูู
- `submitOrderToBackend()` - ุฅุฑุณุงู ุงูุจูุงูุงุช ุฅูู Edge Function
- `getUniqueStores()` - ุงูุญุตูู ุนูู ูุงุฆูุฉ ุงููุชุงุฌุฑ ุงููุฑูุฏุฉ
- `generateRandomOrderCode()` - ุฅูุดุงุก ููุฏ ุทูุจ ุนุดูุงุฆู (8 ุฃุญุฑู)

#### ๐ ุงููุฒุงูุง ุงูุฌุฏูุฏุฉ:
- โ **ุชูุธูู ุชููุงุฆู**: ุฅุฒุงูุฉ ุงูููุชุฌุงุช ุงููุนุทูุจุฉ (ุจุฏูู ID ุฃู ุณุนุฑ ุฃู ูููุฉ)
- โ **ุฏูุฌ ุงูููุฑุฑุงุช**: ุฏูุฌ ุงูููุชุฌุงุช ุงูููุฑุฑุฉ ุจูุงุกู ุนูู `product_id`
- โ **order_code ุนุดูุงุฆู**: 8 ุฃุญุฑู ูุฃุฑูุงู ุจุฏูู ุจุงุฏุฆุฉ (ูุซู: `A1B2C3D4`)
- โ **ุงูุชุญูู ุงูุตุงุฑู**: ุงูุชุฃูุฏ ูู ูุฌูุฏ ุฌููุน ุงูุญููู ุงููุทููุจุฉ
- โ **ุงูุดุญู ุงูุณุฑูุน**: ูู ููุชุฌ ููุฑุณู ูุฑุฉ ูุงุญุฏุฉ ููุท

### 2. `src/pages/CheckoutPage.jsx` (ูุญุฏุซ)
- ุงุณุชุฎุฏุงู ุงูุฏูุงู ุงูุฌุฏูุฏุฉ ุจุฏูุงู ูู ุงูููุทู ุงููุฏูู
- ุชุญุณูู ููุงุกุฉ ุงูููุฏ ููุงุจููุชู ูููุฑุงุกุฉ

### 3. `test-order-payload.js`
ููู ุงุฎุชุจุงุฑ ุดุงูู ูุฌููุน ุงูุฏูุงู

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1. ุชุญุถูุฑ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ
```javascript
import { prepareOrderPayload, submitOrderToBackend } from '@/lib/orderPayloadUtils';

const cartItems = [
  {
    id: 1,
    name: 'ูุงุจุชูุจ ุฏูู',
    price: 350000,
    quantity: 1,
    discounted_price: 320000,
    main_store_name: 'ูุชุฌุฑ ุงูุญุงุณูุจ'
  },
  // ... ุงููุฒูุฏ ูู ุงูููุชุฌุงุช
];

const customer = {
  name: 'ุฃุญูุฏ ูุญูุฏ',
  phone: '07801234567',
  address: 'ุจุบุฏุงุฏุ ุงููุฑุงุฏุฉ',
  city: 'ุจุบุฏุงุฏ',
  notes: 'ุชูุตูู ูุณุงุกู'
};
```

### 2. ููุดุญู ุงูููุญุฏ
```javascript
const unifiedPayload = prepareOrderPayload(
  cartItems,
  customer,
  'unified',         // ููุน ุงูุดุญู
  'ORD-1642501234',  // ููุฏ ุงูุทูุจ
  'key-unique-123'   // ููุชุงุญ ููุน ุงูุชูุฑุงุฑ
);

// ุฅุฑุณุงู ุฅูู Backend
const result = await submitOrderToBackend(
  unifiedPayload,
  'https://wkzjovhlljeaqzoytpeb.supabase.co/functions/v1/order-notification'
);

console.log('ุชู ุฅูุดุงุก ุทูุจ ูุงุญุฏ ููุญุฏ:', result);
```

### 3. ููุดุญู ุงูุณุฑูุน
```javascript
const fastPayload = prepareOrderPayload(
  cartItems,
  customer,
  'fast',            // ููุน ุงูุดุญู
  'ORD-1642501235',  // ููุฏ ุงูุทูุจ
  'fast-key-456'     // ููุชุงุญ ููุน ุงูุชูุฑุงุฑ
);

const result = await submitOrderToBackend(fastPayload, edgeFunctionUrl);

console.log(`ุชู ุฅูุดุงุก ${result.orders_count} ุทูุจุงุช ูููุตูุฉ:`, result);
```

## ๐ช ููุทู ุงููุชุงุฌุฑ

### ุงูุดุญู ุงูุณุฑูุน
- ูู ููุชุฌ ูู ูุชุฌุฑ ูุฎุชูู = ุทูุจ ูููุตู
- ูุซุงู: 3 ููุชุฌุงุช ูู 2 ูุชุฌุฑ = ุทูุจูู ูููุตููู
- ุฃููุงุฏ ุงูุทูุจุงุช: `ORD-123456-1`, `ORD-123456-2`

### ุงูุดุญู ุงูููุญุฏ
- ุฌููุน ุงูููุชุฌุงุช = ุทูุจ ูุงุญุฏ
- ูุซุงู: 3 ููุชุฌุงุช ูู 2 ูุชุฌุฑ = ุทูุจ ูุงุญุฏ
- ููุฏ ุงูุทูุจ: `ORD-123456`

## ๐ ุงูุจูุงูุงุช ุงููุฑุณูุฉ ุฅูู Backend

### ุงูุชูุณูู ุงููุนูุงุฑู
```json
{
  "customer_name": "ุฃุญูุฏ ูุญูุฏ",
  "customer_phone": "07801234567",
  "customer_address": "ุจุบุฏุงุฏุ ุงููุฑุงุฏุฉ",
  "customer_city": "ุจุบุฏุงุฏ",
  "customer_notes": "ุชูุตูู ูุณุงุกู",
  "items": [
    {
      "product_id": 1,
      "product_name": "ูุงุจุชูุจ ุฏูู",
      "main_store_name": "ูุชุฌุฑ ุงูุญุงุณูุจ",
      "quantity": 1,
      "price": 350000,
      "discounted_price": 320000
    }
  ],
  "shipping_type": "unified",
  "order_code": "ORD-1642501234",
  "idempotency_key": "key-unique-123",
  "subtotal": 350000,
  "total_amount": 350000,
  "discounted_price": 320000,
  "delivery_cost": 0
}
```

## ๐ ุงููุฑููุงุช ุงูุฑุฆูุณูุฉ

### ูุจู ุงูุชุญุฏูุซ
```javascript
// ููุฏ ูุนูุฏ ูููุฑุฑ ูู CheckoutPage
const orderData = {
  customer_name: formData.name,
  items: cartItems.map(item => ({
    product_id: item.id,
    // ... ููุทู ูุนูุฏ ูุงุณุชุฎุฑุงุฌ ุงููุชุฌุฑ
  })),
  // ... ุงููุฒูุฏ ูู ุงูุชุนููุฏ
};

const response = await sendOrder(orderData);
```

### ุจุนุฏ ุงูุชุญุฏูุซ
```javascript
// ููุฏ ุจุณูุท ููุธูู
const customerData = { name, phone, address, city, notes };
const payload = prepareOrderPayload(cartItems, customerData, shippingType, orderCode, idempotencyKey);
const result = await submitOrderToBackend(payload, edgeFunctionUrl);
```

## โ ุงููุฒุงูุง ุงูุฌุฏูุฏุฉ

1. **ููุฏ ุฃูุธู**: ูุตู ููุทู ุชุญุถูุฑ ุงูุจูุงูุงุช ุนู ูุงุฌูุฉ ุงููุณุชุฎุฏู
2. **ูุงุจููุฉ ุฅุนุงุฏุฉ ุงูุงุณุชุฎุฏุงู**: ูููู ุงุณุชุฎุฏุงู ุงูุฏูุงู ูู ุฃูุงูู ุฃุฎุฑู
3. **ุณูููุฉ ุงูุงุฎุชุจุงุฑ**: ูู ุฏุงูุฉ ูุงุจูุฉ ููุงุฎุชุจุงุฑ ุจุดูู ูููุตู
4. **ูุนุงูุฌุฉ ุฃูุถู ููุฃุฎุทุงุก**: ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ููููุฏุฉ
5. **ุชูุงูู ูุน Edge Function**: ุงูุจูุงูุงุช ุชุฑุณู ุจุงูุชูุณูู ุงููุทููุจ ุชูุงูุงู

## ๐งช ุงูุงุฎุชุจุงุฑ

```bash
# ุชุดุบูู ููู ุงูุงุฎุชุจุงุฑ
node test-order-payload.js
```

ุงูุงุฎุชุจุงุฑ ูุบุทู:
- ุงูุญุตูู ุนูู ุงููุชุงุฌุฑ ุงููุฑูุฏุฉ โ
- ุงูุดุญู ุงูููุญุฏ โ
- ุงูุดุญู ุงูุณุฑูุน โ
- ุญุงูุงุช ุงูุฎุทุฃ โ
- ุฃูุซูุฉ ุงูุงุณุชุฎุฏุงู โ

## ๐ ุงูุชุทุจูู ูู ุงูุฅูุชุงุฌ

ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ูู:
- โ `code/src/pages/CheckoutPage.jsx`
- โ `neomart0v5/src/pages/CheckoutPage.jsx`
- โ Edge Function ูุชูุงูู ุชูุงูุงู
- โ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุชุฏุนู ุงูุชูุณูู ุงูุฌุฏูุฏ

---

**๐ง ุงูุฑุงุจุท ุงูุญุงูู ููู Edge Function:**
`https://wkzjovhlljeaqzoytpeb.supabase.co/functions/v1/order-notification`
